<!DOCTYPE HTML>
<html lang="ru" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Инструментарий разработчика - Astynax&#x27;s ClojureScript Book</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="what_is_clojure.html"><strong aria-hidden="true">1.</strong> Clojure, что это</a></li><li class="chapter-item expanded "><a href="edn.html"><strong aria-hidden="true">2.</strong> Данные == код</a></li><li class="chapter-item expanded "><a href="syntax.html"><strong aria-hidden="true">3.</strong> Синтаксис Clojure</a></li><li class="chapter-item expanded "><a href="data_manipulation.html"><strong aria-hidden="true">4.</strong> Работа с данными</a></li><li class="chapter-item expanded "><a href="toolchain.html" class="active"><strong aria-hidden="true">5.</strong> Инструментарий разработчика</a></li><li class="chapter-item expanded "><a href="js_interop.html"><strong aria-hidden="true">6.</strong> Взаимодействие с платформой</a></li><li class="chapter-item expanded "><a href="atoms.html"><strong aria-hidden="true">7.</strong> Работа с изменяемым состоянием</a></li><li class="chapter-item expanded "><a href="atoms_and_reactivity.html"><strong aria-hidden="true">8.</strong> Атомы и реактивность</a></li><li class="chapter-item expanded "><a href="complex_state.html"><strong aria-hidden="true">9.</strong> Сложное состояние</a></li><li class="chapter-item expanded "><a href="rum.html"><strong aria-hidden="true">10.</strong> Rum</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Astynax&#x27;s ClojureScript Book</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="Инструментарий-разработчика"><a class="header" href="#Инструментарий-разработчика">Инструментарий разработчика</a></h1>
<h2 id="shadow-cljs"><a class="header" href="#shadow-cljs">Shadow-ClJS</a></h2>
<p>REPL в браузере хорош для первого знакомства с языком, однако с его помощью не получится заниматься непосредственно разработкой. Чтобы разрабатывать реальные проекты на ClojureScript, вам потребуются установленные на вашей ваш компьютер компилятор ClojureScript в JavaScript, инструмент для управления зависимостями (сторонними библиотеками), REPL.</p>
<p>Сейчас все эти задачи берёт на себя инструмент под названием <strong>Shadow-ClJS</strong>. Вы можете найти этот проект по ссылке: https://github.com/thheller/shadow-cljs Самый простой способ установки shadow-cljs, который при этом подходит для большинства пользователей — это генерация проекта с помощью следующей команды:</p>
<pre><code class="language-shell">$ npx create-cljs-project hello
...
</code></pre>
<p>Эта команда создаст директорию с именем &quot;hello&quot; и заполнит необходимым минимумом файлов, среди которых наиболее интересен <code>shadow-cljs.edn</code> — основной файл настройки того, как будет компилироваться ваш проект.</p>
<p>После того, как <em>npx</em> закончит подготавливать проект, вы сможете запустить REPL.</p>
<h2 id="repl"><a class="header" href="#repl">REPL</a></h2>
<p>Компилятор ClojureScript сам по себе является программой, написанной на Clojure и запускается на Java Virtual Machine. Но код на языке JavaScript, которые появляется в результате компиляции ClojureScript­кода, тоже нужно на чём-то запускать — нужна среда исполнения JavaScript. Таковых обычно имеется две на выбор: NodeJS и Web-браузер. REPL, использующий NodeJS для выполнения JavaScript, запускается командой</p>
<pre><code class="language-shell">$ npx shadow-cljs node-repl
</code></pre>
<p>Этот REPL максимально похож на тот, что вы видели на странице Try.Clojure. Вы можете вводить код и видеть результат его выполнения в вашем окне терминала.</p>
<p>REPL, исполняющий JS силами Web­браузера, запускается командой</p>
<pre><code class="language-shell">$ npx shadow-cljs browser-repl
shadow-cljs - config: /home/astynax/Projects/cljs/hello/shadow-cljs.edn
shadow-cljs - server version: 2.20.17 running at http://localhost:9630
shadow-cljs - nREPL server started on port 37463
[:browser-repl] Configuring build.
[:browser-repl] Compiling ...
</code></pre>
<p>После того, как вы запустите эту команду, через какое-то время ваш браузер откроет страницу с текстом &quot;Code entered in a browser-repl prompt will be evaluated here.&quot;. При этом в окне терминала вы всё так же будете видеть так называемое <em>приглашение</em> &quot;<code>cljs.user=&gt;</code>&quot; и сможете вводить код.</p>
<blockquote>
<p>Если окно браузера на открывается автоматически, то вы можете вручную открыть в браузере адрес http://localhost:9630 (номер порта может отличаться, нужный вам вы найдёте среди сообщений, выводимых в терминале — ищите строчку с текстом &quot;server … running at …&quot;).</p>
</blockquote>
<p>Browser REPL является основным, когда вы разрабатываете Web­приложения для браузера. При этом вам доступны многие привычные для Web­разработчика функции, только видите вы их в обёртке ClojureScript. Например, если ввести в ответ на приглашение строчку <code>(js/alert &quot;Hello!&quot;)</code>, то браузер покажет модальное окно с соответствующим сообщением. А если ввести <code>(.log js/console &quot;ping&quot;)</code>, то сообщение уже будет выведено в консоль <em>инструментария разработчика</em> — опять же, в окне браузера.</p>
<h2 id="Первый-код"><a class="header" href="#Первый-код">Первый код</a></h2>
<p>Сгенерированный проект содержит поддиректории <code>src/main</code> и <code>src/test</code>, в которых и принято размещать код и тесты к нему. Код на языке Clojure хранится в файлах, каждый из которых описывает <em>пространство имён</em> (в других языках эти файлы могут называется &quot;модулями&quot;), при этом и файлы, и пространства имён называются в соответствии с соглашением <em>Java Naming Conventions</em>. И как бы нам не хотелось назвать файл просто <code>app.cljs</code>, следует придумать более уникальное и &quot;говорящее&quot; имя вида &quot;company.project.name&quot;.</p>
<p>Создайте файл <code>src/main/com/frontend/app.cljs</code> со следующим содержимым:</p>
<pre><code class="language-clojure">(ns com.frontend.app)

(defn init []
  (js/alert &quot;Hello World!&quot;))
</code></pre>
<p>Чтобы компилятор смог найти этот файл и использовать функцию <code>init</code> как точку входа в программу (вызывать эту функцию при показе Web­страницы), нужно модифицировать <code>shadow-cljs.edn</code>. Нужно изменить значение ключа <code>:builds</code> так, чтобы оно выглядело следующим образом:</p>
<pre><code class="language-edn">{
...

:builds
{:frontend
  {:target :browser
   :modules {:main {:init-fn com.frontend.app/init}}
   }}
}
</code></pre>
<p>Компилятор помещает полученный JavaScript­код в файл <code>publis/js/main.js</code>. А чтобы браузер мог этот файл загрузить, вам понадобится HTML­страница <code>public/index.html</code> следующего вида:</p>
<pre><code class="language-html">&lt;!doctype html&gt;
&lt;html&gt;
  &lt;body&gt;
    &lt;div id=&quot;root&quot;&gt;&lt;/div&gt;
    &lt;script src=&quot;/js/main.js&quot;&gt;&lt;/script&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>И, наконец, нужно включить HTTP­server, встроенный в Shadow-ClJS, чтобы тот мог отдавать браузеру файлы. В <code>shadow-cljs.end</code> нужно добавить следующее:</p>
<pre><code class="language-edn">{
...
:dev-http {8080 &quot;public&quot;} ; &lt;- порт и директория

:builds
{...}

}
</code></pre>
<p>Теперь, если вы запустите shadow-cljs в &quot;режиме разработки&quot; командой</p>
<pre><code class="language-shell">$ npx shadow-cljs watch frontend
...
shadow-cljs - HTTP server available at http://localhost:8080
</code></pre>
<p>Теперь компилятор будет собирать новый JS­файл в ответ на каждое изменение ClojureScript­кода, после чего останется только обновить страницу в браузере! А если вы откроете в браузере адрес http://localhost:8080 то будет вызвана та самая функция <code>init</code> и браузер покажет модальное окно с сообщением.</p>
<p>Важное свойство &quot;режима разработки&quot; заключается в том, что каждое изменение кода после компиляции оного (успешной, разумеется) загружается в браузер автоматически. Это обычно означает, что вам не нужно перезагружать страницу каждый раз, когда вы вносите изменения в код на ClojureScript. Более того, есть способы <strong>сохранить текущее состояние приложения</strong>, даже если логика его работы периодически меняется!</p>
<h3 id="server-watch-cljs-repl"><a class="header" href="#server-watch-cljs-repl">server, watch, cljs-repl</a></h3>
<p>Режим &quot;watch&quot;, он же &quot;режим разработки&quot; всем хорош, кроме того, что вы не имеете возможность коммуницировать с REPL, а можете только редактировать код, который затем загружается в браузер. Но иногда всё же хочется иметь возможность повзаимодействовать с приложением в интерактивном режиме.</p>
<p>Часто такую возможность даёт ваш редактор — если он умеет работать с Clojure и ClojureScript. Для таких редакторов Shadow ClJS предоставляет доступ к так называемому протоколу &quot;nREPL&quot;, поэтому при старте <code>shadow-cljs</code> вы видите сообщение вида &quot;nREPL server started on port …&quot;. Если же вам хочется запускать REPL вручную из терминала, лучше сразу запускать shadow-cljs в <em>режиме сервера</em> командой</p>
<pre><code class="language-shell">$ npx shadow-cljs server frontend
...
shadow-cljs - HTTP server available at http://localhost:8000
shadow-cljs - server version: 2.20.17 running at http://localhost:9630
shadow-cljs - nREPL server started on port 43035
</code></pre>
<p>HTTP­server будет запущен, так что открыть страницу в браузере вы сможете. Но горячая загрузка кода пока не будет работать.</p>
<p>Теперь, уже в другом окне терминала вам нужно запустить ещё один экземпляр Shadow в режиме <code>watch</code> и этот новый экземпляр подключится к уже запущенному серверу:</p>
<pre><code class="language-shell">$ npx shadow-cljs watch frontend
...
shadow-cljs - connected to server
shadow-cljs - watching build :frontend
</code></pre>
<p>В этот момент заработает горячая перезагрузка кода.</p>
<p>Чтобы запустить REPL, вам потребуется третье окно терминала, в котором следует вызвать команду:</p>
<pre><code class="language-shell">$ npx shadow-cljs cljs-repl frontend
...
shadow-cljs - connected to server
cljs.user=&gt;
</code></pre>
<p>Вот и REPL, который работает в связке с браузером, а значит можно с оным пообщаться:</p>
<pre><code class="language-clojure">cljs.user=&gt; (js/alert &quot;Ping!&quot;)
nil
</code></pre>
<p>Чтобы получить доступ к коду, который мы написали в модуле <code>app.cljs</code>, вам нужно в REPL &quot;переключиться&quot; на соответствующее пространство имён — то, которое мы указали в форме <code>(ns ...)</code>:</p>
<pre><code class="language-clojure">cljs.user=&gt; (in-ns 'com.frontend.app)  ;; имя процитировано!
com.frontend.app=&gt; (init)  ;; теперь функция init видна
nil
</code></pre>
<p>Узнайте, как в вашем любимом редакторе обстоят дела с поддержкой Clojure nREPL. Многие редакторы позволяют подключиться к <em>nREPL server</em> напрямую, так что отдельно запускать REPL вам не придётся. Однако знать о такой возможности полезно, поэтому она здесь и упомянута.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="data_manipulation.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="js_interop.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="data_manipulation.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="js_interop.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
